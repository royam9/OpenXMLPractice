"use strict";!function(){function e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Date,t=new Date(e).getFullYear(),n=new Date(e).getMonth()+1,o=new Date(e).getDate();return""+t+(n<10?"0"+n:n)+(o<10?"0"+o:o)}function t(e,t,n){var o=new Date;if(-1==n)return void(document.cookie=e+"="+escape(t)+";domain=.csdn.net;path=/");if(n)o.setTime(o.getTime()+n);else{o.setTime(o.getTime()+2592e6)}document.cookie=e+"="+t+";expires="+o.toGMTString()+";domain=.csdn.net;path=/"}function n(e){for(var t=document.cookie.split("; "),n=0;n<t.length;n++){var o=t[n].split("=");if(o[0]==e&&"UD"==e)return decodeURIComponent(o[1]);if(o[0]==e)return decodeURI(o[1])}}function o(e){if(!e)return!1;var t=(new Date).getTime(),n=new Date(e.startTime.replace(/-/g,"/"));return t<=new Date(e.endTime.replace(/-/g,"/"))&&t>=n}function i(e){return!!e&&(new Date).getTime()>new Date(e.endTime.replace(/-/g,"/")).getTime()}function a(){return!!n("UserName")}function d(){return!n("redpack_close_time")}function c(){return n("p_uid")&&"1"===n("p_uid")[1]}function r(){for(var e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPod","iPad"],n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}function s(){var e=navigator.userAgent;return e.indexOf("Android")>-1||e.indexOf("Adr")>-1}function p(){if(r()&&!s())return!0}function l(e){window.csdn&&window.csdn.report&&window.csdn.report.reportClick(e)}function m(e){window.csdn&&window.csdn.report&&window.csdn.report.reportView(e)}function u(){window.csdn&&window.csdn.report&&window.csdn.report.viewCheck()}function k(){return!!window.csdn.isAppIframe}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://mall.csdn.net/vip";return r()?e+"?utm_source=vip_app_wkhb":e+"?utm_source=vip_pcxwk_hby"}function w(){p()||(this.el=null,this.timer=null,this.rains=[],this.density=300,this.maxCount=Math.floor(2*Math.random()+1),this.maxTime=10,this.timeLineTimer=null,this.currentRedPackId=null,this.timeBoxtimer=null,this.giftId=null,this.host="https://mp-luckydraw1.csdn.net",this.localRedPackIdTime=18e5,this.dev=!1,this.abandonRed=!1,this.autoTimeout=null,this.courentId="",this.nextStart="",this.redpackCheckTimer=null,this.hasRedPacketRain=!1,this.jumpUrl="",this.getRedPackInfo())}void 0;var v=(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent),[]);w.prototype.initRedPack=function(e){if(this.destory(),this.currentRedPackId=e.id,void 0,this.render(),!d())return void 0,void this.destory();if(v.indexOf(e.id)>=0)return void 0,void this.destory();if(v.push(e.id),this.hasRedPacketRain)this.timeOut(e.id).startRedpack(e.id);else{if(!a())return t("redpack_unlogin_click",id,that.localRedPackIdTime),void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));this.timeBox&&this.timeBox.remove(),this.closeBtn&&this.closeBtn.remove(),this.el&&this.el.find(".csdn-redpack").remove(),t("redpack_out_time",this.nextStart,36e5),this.luckyBoy(e.id)}},w.prototype.timeOut=function(e){void 0;var t=this;return t.timeBox.show(),t.timeBoxtimer=setInterval(function(){return void 0,!t.timeBox||t.timeBox.is(":hidden")?(void 0,void clearInterval(t.timeBoxtimer)):--t.maxTime<0&&t.timeBoxtimer?(t.stopRedpack(e),void clearInterval(t.timeBoxtimer)):void t.timeBox.html("00:"+(t.maxTime<10?"0"+t.maxTime:t.maxTime))},1e3),this},w.prototype.render=function(){var e=this;return this.el=$('<div id="csdn-redpack" class="csdn-redpack-container"><span class="csdn-redpack-time">00:10</span><em class="csdn-redpack-close"></em></div>'),this.timeBox=this.el.find(".csdn-redpack-time"),this.closeBtn=this.el.find(".csdn-redpack-close"),this.closeBtn.on("click",function(n){return l({spm:"3001.6686"}),e.destory(),a()?(e.sendGift(),t("redpack",e.courentId,e.localRedPackIdTime),t("redpack_close_time",1,6048e5)):t("redpack_close_time",1,864e5),t("redpack_out_time",e.nextStart,36e5),n.stopPropagation(),!1}),$("body").append(this.el),this},w.prototype.renderBeforeRedpack=function(e){var n=this,o=$('<div class="csdn-redpack-before">\n                  <span class="csdn-redpack-enter"></span>\n                  <span class="csdn-redpack-leave"></span>\n                </div>');return o.find(".csdn-redpack-leave").on("touchstart",function(e){return k()&&window.csdn.appRemoActivityView(),a()&&t("redpack",n.currentRedPackId,n.localRedPackIdTime),n.destory().getRedPackInfo(),e.stopPropagation(),!1}),o.find(".csdn-redpack-enter").on("touchstart",function(t){if(!a())return void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));o.remove(),n.timeOut(e).startRedpack(e)}),n.el.append(o),n},w.prototype.createRedpack=function(e){var n=this,o=$('<div class="csdn-redpack"></div>'),i=r()?Math.max(1.5-Math.random(),.9):Math.max(1.7-Math.random(),1.2),d=(r(),r(),{width:56*i,height:72*i,left:Math.random()*(n.el.width()-30),top:-72*i*1.2});o.css(d),o.on("mousedown",function(o){if(!a())return t("redpack_unlogin_click",e,n.localRedPackIdTime),void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));$(this).addClass("csdn-redpacked"),n.maxCount--,n.maxCount<=0&&n.stopRedpack(e),l({spm:"3001.6027"})}),m({spm:"3001.6686"}),n.el.append(o),n.moveRedpack(o),n.rains.push(o)},w.prototype.startRedpack=function(e){void 0;var t=this;return t.timer=setInterval(function(){t.createRedpack(e)},t.density),this},w.prototype.stopRedpack=function(e){return void 0,clearInterval(this.timer),clearInterval(this.timeBoxtimer),this.timeBox&&this.timeBox.remove(),this.closeBtn&&this.closeBtn.remove(),this.el&&this.el.find(".csdn-redpack").remove(),t("redpack_out_time",this.nextStart,36e5),this.maxCount<1?this.luckyBoy(e):a()?(t("redpack",e,this.localRedPackIdTime),$("#csdn-redpack").remove(),this.sendGift()):(t("redpack",e,this.localRedPackIdTime),this.renderResult()),this},w.prototype.moveRedpack=function(e){var t=this,n=Math.random()+2.5,o=Math.random()-.45,i=0,a=0,d=t.el.height()||1500,c=function t(){i-=1.2*o,a+=1.2*n,e.css({transform:"translate3d("+i+"px, "+a+"px, 0)"}),a>d?e.remove():requestAnimationFrame(t)};requestAnimationFrame(c)},w.prototype.getRedPackInfo=function(){void 0,void 0;var r=this;return window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),d()?n("redpack_out_time")&&!i({endTime:n("redpack_out_time")})?(k()&&window.csdn.appRemoActivityView(),r.destory(),window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.show(),void r.redpackCheck()):!(window.csdn&&window.csdn.toolbarData&&window.csdn.toolbarData.redpackData&&window.csdn.toolbarData.redpackData.status&&window.csdn.toolbarData.redpackData.status.needCheck&&"vip"===window.csdn.toolbarData.redpackData.status.checkType)||a()&&c()?(void 0,$("#csdn-redpack").remove(),$(".csdn-redpack-container").remove(),void $.ajax({url:r.host+"/luckydraw/api/lotteryInProgress",type:"get",data:{bizNo:"download2",targetId:e(),username:n("UserName")||""},contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(e){if(r.dev&&(e={code:200,data:{current:null,next:{id:212,startTime:"2021/05/08 17:41:00",endTime:"2021/05/10 18:50:00"}}}),200===e.code&&e.data){var i=e.data,a=void 0;r.nextStart="",i.current&&i.current.options&&(r.giftId=JSON.parse(i.current.options).couponLotteryId,r.nextStart=i.current.endTime,r.hasRedPacketRain=!0===JSON.parse(i.current.options).hasRedPacketRain),r.courentId=i.current&&i.current.id?i.current.id:"",i.current&&!r.isShowedRedpack(i.current.id)?(a=i.current,void 0):i.next&&!r.isShowedRedpack(i.next.id)&&(a=i.next,void 0),i.next&&(r.nextStart=i.next.startTime),a||void 0,i.current&&!n("redpack")||(k()&&window.csdn.appRemoActivityView(),window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.show()),a||(i.next?t("redpack_out_time",i.next.startTime,36e5):i.current&&t("redpack_out_time",i.current.endTime,36e5)),!i.current&&i.next&&t("redpack_out_time",i.next.startTime,36e5),o(a)&&r.currentRedPackId!==a.id&&(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),a.autoStart?(setTimeout(function(){r.initRedPack(a)},0),l({spm:"3001.6145"}),m({spm:"3001.6145"})):setTimeout(function(){r.renderSelectWindow(a)},0)),r.timeLine(a)}}})):(k()&&window.csdn.appRemoActivityView(),r.destory(),void(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.show())):(k()&&window.csdn.appRemoActivityView(),r.destory(),void(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.show()))},w.prototype.luckyBoy=function(e){void 0;var t=this;$.ajax({url:t.host+"/luckydraw/api/timesWin",type:"post",data:JSON.stringify({lotteryId:e,username:n("UserName")}),contentType:"application/json",xhrFields:{withCredentials:!0},dataType:"json",success:function(e){if(t.dev&&(e={code:200,data:{prizeId:"123",name:"coupon",url:"",money:"0.01"}}),200===e.code&&e.data){var n=e.data||{};t.jumpUrl=h(n.url)||"",t.abandonRed?t.renderNoluck(n):t.renderResult(n)}else t.renderResult({prizeId:null})}})},w.prototype.renderResult=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0;var n=this,o=r();if(!d())return void n.destory();var i="csdn-redpack-sorry",a="";e.options=e.options?JSON.parse(e.options):"",void 0;var c=2===e.type?'<div class="csdn-redpack-article">\n      <div>\n        <img src="'+e.picUrl+'" />\n        <span>'+e.title+"</span>\n      </div>\n      <p>您可点击私信-VIP小助手，按照提示填写收货信息</p>\n    </div>":"",s='<div class="csdn-redpack-coupon">\n      <p class="coupon-money-mes"><em></em><span>¥<span>'+(e.options.amount?e.options.amount:"")+'</span></span></p>\n      <p class="coupon-mes">'+(e.title?e.title:"")+"</p>\n      <p>仅活动期间可用</p>\n    </div>",p='<div class="csdn-redpack-packet">\n      <p class="coupon-money-mes"><em></em><span>¥<span>'+e.money+'</span></span></p>\n      <p class="coupon-mes">'+(e.title?e.title:"")+"</p>\n    </div>";a="",2===e.type?(i="csdn-redpack-article",a=c):e.prizeId&&"common-coupon"===e.name?(i="csdn-redpack-common-coupon",a=s):e.prizeId&&"coupon"===e.name?(i="csdn-redpack-coupon",a=s):e.prizeId&&"redPacket"===e.name?(i="csdn-redpack-cash",a=p):e.prizeId&&"randomRedPacket"===e.name?(i="csdn-redpack-cash",a=p):e.prizeId&&"discountCoupon"===e.name&&(i="csdn-redpack-discount",a=s);var u="csdn-redpack-sorry"!==i?"https://g.csdnimg.cn/common/redpack/images/redpack-hasluck.png":"https://g.csdnimg.cn/common/redpack/images/redpack-noluck.png",h=$('<div class="csdn-redpack-result">\n                   \n                    <a class="csdn-redpack-result-link" data-report-query="spm=3001.6026" href="'+(n.jumpUrl?n.jumpUrl:"javascript:;")+'" '+(n.jumpUrl&&!o?'target="_blank"':"")+'></a>\n                    <div class="csdn-redpack-area">\n                      <img src='+u+" />\n                      "+a+'\n                    </div>\n                    <div class="csdn-redpack-result-close"></div>\n                </div>');this.el.append(h),m({spm:"3001.6653"}),void 0,h.find(".csdn-redpack-result-close").on("click",function(e){k()&&window.csdn.appRemoActivityView(),t("redpack",n.courentId,n.localRedPackIdTime),l({spm:"3001.6687"}),n.destory().getRedPackInfo()}),h.find(".csdn-redpack-result-link").on("click",function(o){k()&&(o.preventDefault(),window.csdn.appActivityOpenUrl(e.url)),l({spm:"3001.6026"}),t("redpack",n.courentId,n.localRedPackIdTime),n.destory().getRedPackInfo()}),n.redpackCheck()},w.prototype.timeLine=function(e){if(e){void 0;var t=this;clearInterval(t.timeLineTimer),t.timeLineTimer=setInterval(function(){if(void 0,!d())return void t.destory();o(e)&&t.currentRedPackId!==e.id&&(window.csdn.wapPopAdvert&&window.csdn.wapPopAdvert.close(),t.renderSelectWindow(e)),i(e)&&(t.destory(),t.getRedPackInfo())},2e4),$(document).off("visibilitychange").on("visibilitychange",function(e){void 0,document.hidden?t.destory():t.getRedPackInfo()})}},w.prototype.destory=function(){return void 0,void 0,void 0,void 0,clearInterval(this.timeLineTimer),clearInterval(this.timeBoxTimer),clearInterval(this.timer),clearInterval(this.autoTimeout),clearInterval(this.redpackCheckTimer),this.el&&this.el.remove(),$(".csdn-redpack-container").remove(),$(".csdn-reapck-select").remove(),$("body").find(".csdn-redpack-lottery-btn-box").remove(),$(".redpack-select-noluck").remove(),this.rains=[],this.density=300,this.maxCount=Math.floor(2*Math.random()+1),this.maxTime=10,this.currentRedPackId=null,this.abandonRed=!1,this.autoTimeout=null,this.timeBox=null,this.redpackCheckTimer=null,this},w.prototype.isShowedRedpack=function(e){return e==n("redpack")},w.prototype.renderLotteryBtn=function(e){var o=this,i=window.location.host,d=window.location.pathname,c="",r="",s="",p="";if(this.currentRedPackId=e.id,Number(n("redpack_unlogin_click"))===e.id&&a())return void this.initRedPack(e);if(i.indexOf("blog.csdn.net")>=0?"/"===d?c=".container":2===d.split("/").length?c=$(".user-profile-body-right").length?".user-profile-body-right":".container":d.split("/").length>2&&d.indexOf("/article/details")>=0&&(c=".main_father"):c=i.indexOf("download.csdn.net")>=0?".main":i.indexOf("edu.csdn.net")>=0&&0===d.indexOf("/course/detail")?".right":i.indexOf("marketing.csdn.net")>=0?".container":i.indexOf("mall.csdn.net")>=0&&0===d.indexOf("/lottery-draw")?".home_wrap":"",c){if(r=$(c),".right"===c)s=r.width()+r.offset().left-20,p="bottom: 375px;";else if(".main_father"===c){s=-100;var m=setInterval(function(){$(".csdn-side-toolbar")&&$(".csdn-side-toolbar").offset()&&($(".csdn-redpack-lottery-btn-box").css({left:$(".csdn-side-toolbar").offset().left-20}),clearInterval(m))},500)}else s=r.width()+r.offset().left-20;var k=a()?"点我抢红包啦!":"快快快！登录CSDN抢红包啦！",h=$('<div class="csdn-redpack-lot\n      tery-btn-box" style="left: '+s+"px;"+p+'" data-report-view=\'{"spm": "3001.6025"}\'>\n        <div class="lottery-btn-box-content">\n          <img src="https://g.csdnimg.cn/common/redpack/images/lottery-monkey.gif" alt="">\n        </div>\n        <div class="lottery-btn-box-hint '+(a()?"lottery-login-hint":"lottery-unlogin-hint")+'">'+k+'</div>\n        <div class="lottery-btn-box-close"></div>\n      </div>');h.on("click",".lottery-btn-box-content",function(){a()?o.initRedPack(e):(window.csdn.loginBox.show(),t("redpack_unlogin_click",e.id,o.localRedPackIdTime)),l({spm:"3001.6025",extra:JSON.stringify({isLogin:a()})})}).on("click",".lottery-btn-box-close",function(){return $("body").find(".csdn-redpack-lottery-btn-box").remove(),t("redpack_close_time",1,6048e5),l({spm:"3001.6026"}),!1}),$("body").append(h),u()}},w.prototype.renderSelectWindow=function(e){var o=this;this.destory();var i=!0,d=a()?1e4:6e4;if(window.csdn&&window.csdn.toolbarData&&window.csdn.toolbarData.redpackData&&window.csdn.toolbarData.redpackData.autoClick&&(i=window.csdn.toolbarData.redpackData.autoClick.need,d=a()?1e3*window.csdn.toolbarData.redpackData.autoClick.hasLoginTime:1e3*window.csdn.toolbarData.redpackData.autoClick.noLogin),Number(n("redpack_unlogin_click"))===e.id&&a())return void this.selectLucky(e);var c=this,r=$('<div class="csdn-reapck-select">\n      <div class="redpack-select-back">\n      <div class="redpack-select-container">\n        <div class="redpack-select-go"></div>\n        <div class="redpack-select-return"></div>\n      </div>\n    </div>');return $("body").append(r),r.on("click",".redpack-select-go",function(){if(r.remove(),!a())return t("redpack_unlogin_click",e.id,c.localRedPackIdTime),void(window.location.href="https://passport.csdn.net/account/login?utm_source=redpack&from="+encodeURIComponent(window.location.href));l({spm:"3001.6654"}),c.selectLucky(e)}).on("click",".redpack-select-return",function(){r.remove(),l({spm:"3001.6652"}),c.removeSelect()}),m({spm:"3001.6652"}),i&&(this.autoTimeout=setTimeout(function(){r.remove(),o.selectLucky(e)},d)),this},w.prototype.selectLucky=function(e){a()&&t("redpack",e.id,this.localRedPackIdTime),this.initRedPack(e)},w.prototype.removeSelect=function(){$(".csdn-reapck-select").remove(),a()?t("redpack_close_time",1,6048e5):t("redpack_close_time",1,864e5),clearTimeout(this.autoTimeout),this.autoTimeout=null,a()?this.sendGift():k()&&window.csdn.appRemoActivityView()},w.prototype.sendGift=function(){if(window.csdn&&window.csdn.toolbarData&&window.csdn.toolbarData.redpackData&&!window.csdn.toolbarData.redpackData.defaultSendCoupon)return void(k()&&window.csdn.appRemoActivityView());this.giftId&&this.luckyBoy(this.giftId),this.abandonRed=!!this.giftId},w.prototype.renderNoluck=function(e){var t=this,n=$('<div class="redpack-select-noluck">\n      <div class="redpack-select-noluck-back"></div>\n      <div class="redpack-select-noluck-area">\n        <em class="redpack-select-noluck-close"></em>\n        <div class="redpack-select-noluck-text">\n          <p class="coupon-money-mes"><em></em><span>¥<span>'+e.money+'</span></span></p>\n          <p>很抱歉~</p>\n          <p>补偿您VIP抵扣券</p>\n        </div>\n        <a class="redpack-select-noluck-go" data-report-query="spm=3001.6688" href="'+(t.jumpUrl?t.jumpUrl:"javascript:;")+'" '+(t.jumpUrl&&!r()?'target="_blank"':"")+"></a>\n      </div>\n    </div>");$("body").append(n),m({spm:"3001.6688"}),n.on("click",".redpack-select-noluck-go",function(n){k()&&(n.preventDefault(),window.csdn.appActivityOpenUrl(e.url)),l({spm:"3001.6688"}),t.destory().getRedPackInfo()}).on("click",".redpack-select-noluck-close",function(){k()&&window.csdn.appRemoActivityView(),n.remove(),t.destory().getRedPackInfo()})},w.prototype.redpackCheck=function(){var e=this;clearInterval(this.redpackCheckTimer),this.redpackCheckTimer="",this.redpackCheckTimer=setInterval(function(){i({endTime:n("redpack_out_time")})&&e.destory().getRedPackInfo()},2e4)},window.csdn=window.csdn||{},window.csdn.redpack=new w}();